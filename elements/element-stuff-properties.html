<!--
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="element-stuff-base.html">
<link rel="import" href="element-stuff-shared-styles.html">

<dom-module id="element-stuff-properties">
  <template strip-whitespace>
    <style include="element-stuff-shared-styles"></style>
    <div class="content-wrapper">
      <div>
        <label for="textContent">textContent</label>
        <input name="textContent" id="textContent">
        <label for="id">id</label>
        <input name="id" id="id">
        <label for="slot">slot</label>
        <input name="slot" id="slot">
        <label for="classList">classList</label>
        <input name="classList" id="classList">
      </div>
      <div id="bonus"></div>
  </div>
  </template>
  <script>
    class ElementProperties extends ElementStuffBase(Polymer.Element) {
      static get is() { return 'element-stuff-properties'; }
      constructor() {
        super();
        this.stuffType = 'property';
      }
      ready() {
        super.ready();
        //this.$.filterElement1.addEventListener('input', this.findElement1.bind(this));
      }
      display(target) {
        //console.log(target);
        this._displayBasicProperties(target);
        this.$.bonus.innerHTML = '';

        // If this is the top level div, we don't want any other properties shown.
        if (target.id === 'viewContainer') {
          return;
        }

        // If this is a native element, then start walking up the prototype
        // chain to get all the props it has. If it's a custom element,
        // then assume it's a v1 element and look at its observedAttributes
        let attrNames = window.getAttributesIfCustomElement(target);
        this._displayPropsOrAttributes(target, attrNames, true);

        let propNames = window.getProtoProperties(target);
        this._displayPropsOrAttributes(target, propNames);
      }

      _displayBasicProperties(target) {
        
        for (let i = 0; i < this._stuff.length; i++) {
          let prop = this._stuff[i];
          let el = this.root.querySelector(`[name=${prop}]`);
          // Ugh
          if (prop === 'attributes') {
            let v = '';
            for(let a = 0; a < target.attributes.length; a++) {
              let name = target.attributes[a].name;
              if (name != 'class' && name != 'style' && name != 'id') {
                v += name + '=' + target.attributes[a].value + ' ';
              }
            }
            el.value = v.trim();
          } else if (prop === 'classList') {
            // Lol what's a blacklist.
            el.value = target[prop].toString().replace('active', '').replace('dragging', '').replace('resizing', '');
            if (target.id === 'viewContainer') {
              el.value = el.value.replace('iron-selected', '');
            }
          } else if (prop === 'textContent') {
            // If this element has children, then disable textContent since
            // changing it will only lead to surprise tears.
            if (target.children.length !== 0) {
              el.value = '';
              el.disabled = true;
            } else {
              el.value = target[prop];
              el.disabled = false;
            }
          } else {
            el.value = target[prop];
          }
        }
      }

      _displayPropsOrAttributes(target, propNames, isAttribute) {
        // console.log(propNames);
        for (let i = 0; i < propNames.length; i++) {
          let name = propNames[i];
          // Ignore things that start with a _. Polymer converts every property
          // to an observed attribute, so you might get a lot of private
          // things in here.
          if (name.indexOf('_') === 0) {
            continue;
          }          

          let label = document.createElement('label');
          label.textContent = name;
          label.setAttribute('for', name);
          // label.htmlFor = name;
          this.$.bonus.appendChild(label);
          let input = document.createElement('input');
          input.name = name;
          input.setAttribute('id', name);
          if (isAttribute) {
            input.classList.add('attribute');
            if (name === 'items' && target.localName === 'dom-repeat') {
              // We did a giant hack for dom-repeats where we can't actually set
              // the items property, since that would immediately stamp the children,
              // so instead we set fakeItemsAttr as a convention (see
              // app-shell::updateActiveElementValues). Anyway, fake display it
              // correctly here.
              input.value = target.dataset['fakeItemsAttr'] || '';
            } else {
              input.value = target.getAttribute(name) || '';
            }
          } else {
            input.value = target[name] || '';
          }
          this.$.bonus.appendChild(input);

          var componentName = target.attributes.class.ownerElement.localName;
          var comment = this.writeComments(name,componentName);

          if(comment != ""){
            let button = document.createElement('button');
            button.innerHTML= 'Info';
            button.onclick = function(){
              let p = document.createElement('p');
              p.innerHTML = comment;
              button.appendChild(p);
            };
            // here we will insert the comment, that describes de variable, above it 
            // par.style.color = "green";
            // par.style.fontSize = "13px";
            this.$.bonus.appendChild(button);
          }
        }
      }

      writeComments (nameOfVariable,nameOfComponent) {

        var file = "../bower_components/"+ nameOfComponent +"/analysis.jason";
        
        var rawFile = new XMLHttpRequest();
        var textRead = "";
        rawFile.open("GET", file, false);
        rawFile.onreadystatechange = function () {
            if(rawFile.readyState === 4) {
                if(rawFile.status === 200 || rawFile.status == 0) {
                    var allText = rawFile.responseText;
                    
                    var n = allText.indexOf (nameOfVariable, 0);               //searching the position of the name of the variable that we are looking for
                    if(n != -1){
                        var position = allText.indexOf ("description", n);           //searching the position where is the next description
                        position = allText.indexOf ("\"", position+1);               //passing the first " character after the word description
                        position = allText.indexOf ("\"", position+1);               //passing the second " character (where the comment starts) 
                        var position2 = allText.indexOf ("\"", position+1);          //position where the comment ends
                        textRead = allText.substr(position+1 ,position2-position-1);  //variable for save all the characters of the comment
                    }
                }
            }
        }
        rawFile.send(null);
        return textRead;
      }
    }
    customElements.define(ElementProperties.is, ElementProperties);
  </script>
</dom-module>
